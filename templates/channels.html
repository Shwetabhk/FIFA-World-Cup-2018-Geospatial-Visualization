{%extends 'home.html' %} {%load static%} {%block head%}

<body>
    <nav class="navbar navbar-expand-sm bg-dark">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="/">
                    <span class='fa fa-home fa-lg'></span>
                    Home
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/teams/">
                    <span class='fa fa-users fa-lg'></span>
                    Teams
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/stadiums/">
                    <span class='fa fa-road fa-lg'></span>
                    Stadiums
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link navactive" href="/channels/">
                    <span class='fa fa-tv fa-lg'></span>
                    Channels
                </a>
            </li>
        </ul>
        {%if request.user.is_authenticated%}
        <a href="/logout/" style="margin-left:900px">
            <span class="fa fa-sign-out-alt fa-lg"></span>
            Logout
        </a>
        {% endif %}
    </nav>
    <div class="col-sm-4">
        <nav class='menu-ui'>
            <a href='#' class='active' data-filter='all'>Show all</a>
            <a href='#' data-filter='English'>English</a>
            <a href='#' data-filter='Danish'>Danish</a>
            <a href='#' data-filter='Portuguese'>Portuguese</a>
            <a href='#' data-filter='Spanish; Castilian'>Spanish</a>
            <a href='#' data-filter='Breton'>Breton</a>
            <a href='#' data-filter='Polish'>Polish</a>
            <a href='#' data-filter='German'>German</a>
            <a href='#' data-filter='Indonesian'>Indonesian</a>
        </nav>
    </div>
    <div class="col-sm-6 float-right">
        <div id='map'></div>
        <script>
            var data = JSON.parse('{{channels}}'.replace(/&quot;/g, '"').replace(/&#39;/g, ""));
            console.log(data);
            var apiKey = '{{secretToken}}';
            var mapCenter = [55.715765, 37.551521708]

            L.mapbox.accessToken = apiKey;

            var map = L.mapbox.map('map', 'mapbox.dark', {
                zoomControl: true
            }).setView([mapCenter[0], mapCenter[1]], 1);

            map.dragging.disable();
            map.touchZoom.disable();

            var markers = L.mapbox.featureLayer().addTo(map);
            markers.setGeoJSON(data);
            console.log(markers);
            markers.on('click', function (e) {
                e.layer.closePopup();

                var feature = e.layer.feature;
                var title = feature.properties.title;
                var content = feature.properties.description;
                var city = feature.properties.address;

                $("#marker_title").text(title);
                $("#marker_content").text(content);
                $("#marker_latlng").text(city);
                $('#exampleModal').modal('show');
            });

            $('.menu-ui a').on('click', function () {
                var filter = $(this).data('filter');
                $(this).addClass('active').siblings().removeClass('active');
                markers.setFilter(function (f) {
                    return (filter === 'all') ? true : f.properties.language === filter;
                });
                return false;
            });
        </script>
    </div>
    </div>
    </div>
</body>
{%endblock%}