{%load static%}
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
  <link href='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.css' rel='stylesheet' />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ"
    crossorigin="anonymous">
  <link rel="shortcut icon" href="{%static 'favicon/favicon.ico' %}">
  <link rel="stylesheet" href='{%static "css/home.css"%}'>
  <title>Fifa 2018 Geo Visualization</title>
</head>

{%block head%}

<body>
  <nav class="navbar navbar-expand-sm bg-dark">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link navactive" href="/">
          <span class='fa fa-home fa-lg'></span>
          Home
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/teams/">
          <span class='fa fa-users fa-lg'></span>
          Teams
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/stadiums/">
          <span class='fa fa-road fa-lg'></span>
          Stadiums
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/channels/">
          <span class='fa fa-tv fa-lg'></span>
          Channels
        </a>
      </li>
    </ul>
    {%if request.user.is_authenticated%}
    <a href="logout/" style="margin-left:900px">
      <span class="fa fa-sign-out-alt fa-lg"></span>
      Logout
    </a>
    {% endif %}
  </nav>
  <div class="container-fluid">
    <div class="row mt-4 ">
      <div class="col-sm-6">
        <div id="exampleModal" tabindex="-1">
          <div>
            <div>
              <div>
                <h3 id="marker_title" class=""></h3>
                <p id="marker_city" class=""></p>
                <img id="marker_content">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-6 float-right">
        <nav class='menu-ui'>
          <a href='#' class='active' data-filter='all'>Show all</a>
          <a href='#' data-filter='water'>Water Recreation</a>
          <a href='#' data-filter='outdoor'>Outdoor Recreation</a>
          <a href='#' data-filter='civil'>Civil War</a>
          <a href='#' data-filter='wildlife'>Wildlife</a>
          <a href='#' data-filter='heritage'>Heritage & Culture</a>
        </nav>
        <div id='map'></div>
        <script>
          var data = JSON.parse('{{stadiums}}'.replace(/&quot;/g, '"').replace(/&#39;/g, ""));
          console.log(data);
          var apiKey = '{{secretToken}}';
          var mapCenter = [55.715765, 37.551521708]

          L.mapbox.accessToken = apiKey;

          var map = L.mapbox.map('map', 'mapbox.dark', {
            zoomControl: true
          }).setView([mapCenter[0], mapCenter[1]], 3);

          map.touchZoom.disable();

          var markers = L.mapbox.featureLayer().addTo(map);
          markers.setGeoJSON(data);
          markers.on('click', function (e) {
            e.layer.closePopup();

            var feature = e.layer.feature;
            var title = feature.properties.title;
            var content = feature.properties.description;
            var city = feature.properties.address;

            $("#marker_title").text(title);
            $("#marker_city").text(city);
            $("#marker_content").attr('src', content);
            $("#marker_content").attr('style', "width: 500px; height:400px");
          });

          $('.menu-ui a').on('click', function () {
            var filter = $(this).data('filter');
            $(this).addClass('active').siblings().removeClass('active');
            markers.setFilter(function (f) {
              return (filter === 'all') ? true : f.properties[filter] === true;
            });
            return false;
          });
        </script>
      </div>
    </div>
  </div>
</body>
{%endblock%}

</html>